package com.yonyou.scf.common.helper;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.yonyou.scf.common.constant.DefaultConst;
import com.yonyou.scf.common.constant.FrontEndProcessConstant;
import com.yonyou.scf.common.constant.MessengerErrorMsgConstants;
import com.yonyou.scf.common.constant.URLConst;
import com.yonyou.scf.common.output.ResultBean;
import com.yonyou.scf.common.system.CodeException;
import com.yonyou.scf.common.tx.api.TxRequest;
import com.yonyou.scf.common.tx.mail.SMSSend;
import com.yonyou.scf.common.util.net.ResUtil;

public class SMSHelper {

	private static final Logger logger = LoggerFactory.getLogger(SMSHelper.class);
	
	public static Boolean doSend(String platformId, String mobile, String text, String txNo) throws CodeException {

		ResultBean rb = new ResultBean();

		try {

			SMSSend sms = new SMSSend();
			sms.setMobile(mobile);
			sms.setText(text);
			sms.setTxNo(txNo);
			
			// TODO:签名 + 组装
			TxRequest txReq = SignatureHelper.doSignToTxRequest(sms);
			txReq.setPlatformId(platformId);
//			txReq.setUrlParam(FrontEndProcessConstant.URL_SEND);
			//txReq.setInterfaceNo(APIConstant.API_SCF1103);
			txReq.setApiId(URLConst.URL_SMS + "/Send");//59200/SMS/Send
			txReq.setBrowser("ie");
			logger.info("SMSHelper:request:" + txReq.toString());

			rb = ResUtil.send2ActiveFEP(txReq);
			logger.info("SMSHelper:response:" + rb.toString());

			if (!DefaultConst.SUCCESS_RESPONSE_CODE.equals(rb.getCode())) {
				logger.error(rb.getCode() + ":" + rb.getMessage());
				throw new CodeException(DefaultConst.ERR_2001_CODE, "短信发送失败");
			}


		} catch (CodeException ce) {
			throw ce;
		} catch (Exception e) {
			System.out.println("ERROR : " + e.toString());
			e.printStackTrace();
			throw new CodeException(MessengerErrorMsgConstants.ERR_2001_CODE, MessengerErrorMsgConstants.ERR_2001_MSG);
		}

		return true;
	}
}
